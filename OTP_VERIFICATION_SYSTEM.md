# ๐ ูุธุงู ุงูุชุญูู OTP ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ุงุญุชุฑุงูู ููุชุญูู ูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุจุงุณุชุฎุฏุงู ุฑูุฒ OTP (One-Time Password) ุงููููู ูู 6 ุฃุฑูุงู.

---

## โจ ุงููููุฒุงุช ุงูุฑุฆูุณูุฉ

### 1. **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุณุฉ**
- โ ุฅุฏุฎุงู ุงูุฑูุฒ ูู 6 ุญููู ูููุตูุฉ
- โ ุงูุงูุชูุงู ุงูุชููุงุฆู ุจูู ุงูุญููู
- โ ุฏุนู ุงููุตู (Paste) ูู ุงูุญุงูุธุฉ
- โ ุงูุชุญูู ุงูุชููุงุฆู ุนูุฏ ุฅุฏุฎุงู ุงูุฑูู ุงูุฃุฎูุฑ
- โ ูุณุญ ุงูุญููู ุชููุงุฆูุงู ุนูุฏ ุงูุฎุทุฃ

### 2. **ุงูุฃูุงู**
- ๐ 5 ูุญุงููุงุช ููุท ูุฅุฏุฎุงู ุงูุฑูุฒ
- โฑ๏ธ ุตูุงุญูุฉ ุงูุฑูุฒ 10 ุฏูุงุฆู
- ๐ ุฅุนุงุฏุฉ ุฅุฑุณุงู ูุน ูุคูุช 60 ุซุงููุฉ
- ๐๏ธ ุญุฐู ุงูุฑูุฒ ุชููุงุฆูุงู ุจุนุฏ ุงูุชุญูู
- ๐ ุชุชุจุน ุนุฏุฏ ุงููุญุงููุงุช

### 3. **ุงูุชุตููู**
- ๐จ ูุงุฌูุฉ ุงุญุชุฑุงููุฉ ูุชูุงุณูุฉ ูุน ุงููููุฉ ุงูุจุตุฑูุฉ
- ๐ฑ ุงุณุชุฌุงุจุฉ ูุงููุฉ ูุฌููุน ุงูุฃุฌูุฒุฉ
- โจ ุฃููููุดู ุณูุณุฉ ูุฌุฐุงุจุฉ
- ๐ ุชุบููุฑ ุงูุฃููุงู ุญุณุจ ุงูุญุงูุฉ

---

## ๐ ูููุงุช ุงููุธุงู

### 1. API Endpoints

#### **`/api/send-otp/route.ts`**
```typescript
ุงููุธููุฉ: ุฅูุดุงุก ูุฅุฑุณุงู ุฑูุฒ OTP
ุงููุฏุฎูุงุช:
  - email: ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
  - userId: ูุนุฑู ุงููุณุชุฎุฏู ูู Firebase

ุงูุนูููุงุช:
  1. ุชูููุฏ ุฑูุฒ ุนุดูุงุฆู ูููู ูู 6 ุฃุฑูุงู
  2. ุญูุธ ุงูุฑูุฒ ูู Firestore ูุน:
     - ููุช ุงูุฅูุดุงุก
     - ููุช ุงูุงูุชูุงุก (10 ุฏูุงุฆู)
     - ุนุฏุฏ ุงููุญุงููุงุช (0)
     - ุญุงูุฉ ุงูุชุญูู (false)
  3. ุฅุฑุณุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
  4. ุฅุฑุฌุงุน ุงูุฑูุฒ ูู ูุถุน ุงูุชุทููุฑ

ุงููุฎุฑุฌุงุช:
  - success: true/false
  - message: ุฑุณุงูุฉ ุงูุชุฃููุฏ
  - devOTP: ุงูุฑูุฒ (ูู ูุถุน ุงูุชุทููุฑ ููุท)
```

#### **`/api/verify-otp/route.ts`**
```typescript
ุงููุธููุฉ: ุงูุชุญูู ูู ุตุญุฉ ุฑูุฒ OTP
ุงููุฏุฎูุงุช:
  - userId: ูุนุฑู ุงููุณุชุฎุฏู
  - otp: ุงูุฑูุฒ ุงูููุฏุฎู

ุงูุนูููุงุช:
  1. ุฌูุจ ุจูุงูุงุช OTP ูู Firestore
  2. ุงูุชุญูู ูู:
     - ูุฌูุฏ ุงูุฑูุฒ
     - ุนุฏู ุงูุชุญูู ููู ูุณุจูุงู
     - ุนุฏุฏ ุงููุญุงููุงุช (< 5)
     - ุตูุงุญูุฉ ุงูููุช
  3. ููุงุฑูุฉ ุงูุฑูุฒ
  4. ุชุญุฏูุซ ุญุงูุฉ ุงููุณุชุฎุฏู ูู ุญุงูุฉ ุงููุฌุงุญ
  5. ุญุฐู ุงูุฑูุฒ ุจุนุฏ ุงูุชุญูู

ุงููุฎุฑุฌุงุช:
  - success: true/false
  - message: ุฑุณุงูุฉ ุงููุชูุฌุฉ
  - remainingAttempts: ุงููุญุงููุงุช ุงููุชุจููุฉ
```

---

### 2. ุตูุญุฉ ุงูุชุญูู

#### **`/app/auth/verify-otp/page.tsx`**
```
ุงูููููุงุช:
  - 6 ุญููู ุฅุฏุฎุงู ููุฃุฑูุงู
  - ุฒุฑ ุงูุชุญูู
  - ุฒุฑ ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู ูุน ูุคูุช
  - ุฑุณุงุฆู ุงูุญุงูุฉ ูุงูุฃุฎุทุงุก
  - ูุตุงุฆุญ ูููุณุชุฎุฏู

ุงููุธุงุฆู:
  โ handleChange - ูุนุงูุฌุฉ ุชุบููุฑ ุงูุฅุฏุฎุงู
  โ handleKeyDown - ูุนุงูุฌุฉ ููุชุงุญ Backspace
  โ handlePaste - ูุนุงูุฌุฉ ุงููุตู
  โ handleVerify - ุงูุชุญูู ูู ุงูุฑูุฒ
  โ handleResend - ุฅุนุงุฏุฉ ุฅุฑุณุงู ุงูุฑูุฒ

ุงูุญุงูุงุช:
  - idle: ุงูุญุงูุฉ ุงูุฃูููุฉ
  - error: ุฑูุฒ ุฎุงุทุฆ
  - success: ุชู ุงูุชุญูู ุจูุฌุงุญ
```

---

## ๐ ุณูุฑ ุงูุนูู ุงููุงูู

```
ุงููุณุชุฎุฏู
  โ
1. ูููุฃ ูููุฐุฌ ุงูุชุณุฌูู
  โ
2. ูุถุบุท "ุฅูุดุงุก ุญุณุงุจ"
  โ
3. ุงููุธุงู ูููุดุฆ ุงูุญุณุงุจ ูู Firebase
  โ
4. ููุฑุณู ุทูุจ POST ุฅูู /api/send-otp
  โ
5. ูููุดุฃ ุฑูุฒ OTP ุนุดูุงุฆู (6 ุฃุฑูุงู)
  โ
6. ููุญูุธ ุงูุฑูุฒ ูู Firestore/otpCodes/{userId}
  โ
7. ููุฑุณู ุจุฑูุฏ ุฅููุชุฑููู ูููุณูู ุจุงูุฑูุฒ
  โ
8. ุชูุฌูู ุงููุณุชุฎุฏู ุฅูู /auth/verify-otp
  โ
9. ุงููุณุชุฎุฏู ููุชุญ ุจุฑูุฏู ููุฑู ุงูุฑูุฒ
  โ
10. ููุฏุฎู ุงูุฑูุฒ ูู ุงูุญููู ุงูุณุชุฉ
  โ
11. ุชุญูู ุชููุงุฆู ุนูุฏ ุฅุฏุฎุงู ุงูุฑูู ุงูุฃุฎูุฑ
  โ
12. ููุฑุณู ุทูุจ POST ุฅูู /api/verify-otp
  โ
13. ุงูุชุญูู ูู ุตุญุฉ ุงูุฑูุฒ ูุงูุตูุงุญูุฉ
  โ
14. ุชุญุฏูุซ users/{userId}/emailVerified = true
  โ
15. ุญุฐู ูุซููุฉ OTP
  โ
16. ุนุฑุถ ุฑุณุงูุฉ ูุฌุงุญ
  โ
17. ุชูุฌูู ุชููุงุฆู ููุตูุญุฉ ุงูุฑุฆูุณูุฉ โ
```

---

## ๐ง ูุงูุจ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู

```html
ุชุตููู ุงุญุชุฑุงูู ูุชุถูู:
  - ุฑุฃุณูุฉ ุจุชุฏุฑุฌ ูููู (Primary โ Purple)
  - ุดุนุงุฑ AF BTEC
  - ุงูุฑูุฒ ุจุฎุท ูุจูุฑ ูุงุถุญ
  - ููุช ุงูุตูุงุญูุฉ (10 ุฏูุงุฆู)
  - ุชุญุฐูุฑ ุฃููู
  - ุชุฐููู ุจุญููู ุงููููุน
```

### ุงูุนูุงุตุฑ:
```
๐ฑ ูุชุฌุงูุจ ูุน ุงูููุจุงูู
๐จ ุฃููุงู ูุชูุงุณูุฉ ูุน ุงููููุฉ
๐ค ุฎุท Courier New ููุฑูุฒ
โ๏ธ ุชุญุฐูุฑ ูุงุถุญ
```

---

## ๐จ ูุงุฌูุฉ ุงููุณุชุฎุฏู

### ุญููู ุงูุฅุฏุฎุงู (OTP Inputs)

```css
ุงูููุงุตูุงุช:
  - ุงูุนุฑุถ: 56px ร 64px (Desktop)
  - ุงูุช<br>ุถ: 48px ร 56px (Mobile)
  - ุงูุฎุท: 24px Bold
  - ุงูุญุฏูุฏ: 2px solid
  - Border Radius: 12px
  - Background: rgba(255,255,255,0.05)

ุงูุญุงูุงุช:
  1. ูุงุฑุบ: border-white/10
  2. ููููุก: border-primary/50
  3. ุฎุทุฃ: border-red-500/50
  4. Focus: ring-2 ring-primary/50
  5. ูุนุทูู: opacity-50
```

### ุงูุฃููุงู ุญุณุจ ุงูุญุงูุฉ

```css
/* Idle - ุงูุญุงูุฉ ุงูุฃูููุฉ */
border: rgba(255, 255, 255, 0.1)
text: white

/* Active - ุนูุฏ ุงููุชุงุจุฉ */
border: rgba(59, 130, 246, 0.5)
ring: rgba(59, 130, 246, 0.5)

/* Error - ุนูุฏ ุงูุฎุทุฃ */
border: rgba(239, 68, 68, 0.5)
text: red-400

/* Success - ุนูุฏ ุงููุฌุงุญ */
background: green-500/10
text: green-400
```

---

## ๐ง ุงูุฅุนุฏุงุฏุงุช ุงููุทููุจุฉ

### 1. Firebase Firestore

ุฅูุดุงุก ูุฌููุนุฉ (Collection):
```
otpCodes/
  โโโ {userId}/
      โโโ code: string
      โโโ email: string
      โโโ createdAt: timestamp
      โโโ expiresAt: timestamp
      โโโ verified: boolean
      โโโ attempts: number
```

### 2. ุฎุฏูุฉ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู

ุงุฎุชุฑ ูุงุญุฏุฉ ูู:
```javascript
// Option 1: Resend (ูููุตู ุจู)
npm install resend

// Option 2: SendGrid
npm install @sendgrid/mail

// Option 3: Nodemailer
npm install nodemailer

// Option 4: AWS SES
npm install @aws-sdk/client-ses
```

### 3. ูุชุบูุฑุงุช ุงูุจูุฆุฉ (.env.local)

```bash
# Firebase (ููุฌูุฏ ุจุงููุนู)
NEXT_PUBLIC_FIREBASE_API_KEY=...
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=...
NEXT_PUBLIC_FIREBASE_PROJECT_ID=...

# Email Service (ุงุฎุชุฑ ูุงุญุฏ)
RESEND_API_KEY=re_...          # Resend
SENDGRID_API_KEY=SG....        # SendGrid
EMAIL_USER=your@gmail.com      # Gmail SMTP
EMAIL_PASS=your_app_password   # Gmail App Password
```

---

## ๐ฑ ุงูุชุฌุงูุจ (Responsive)

```css
/* Mobile (< 640px) */
Input Size: 48px ร 56px
Font Size: 20px
Gap: 8px

/* Desktop (โฅ 640px) */
Input Size: 56px ร 64px
Font Size: 24px
Gap: 8px
```

---

## โ๏ธ ุงูุชุฎุตูุต

### ุชุบููุฑ ุตูุงุญูุฉ ุงูุฑูุฒ:
```typescript
// ูู /api/send-otp/route.ts
expiresAt: new Date(Date.now() + 10 * 60 * 1000)
// ุชุบููุฑ 10 ุฅูู ุงููุฏุฉ ุงููุทููุจุฉ ุจุงูุฏูุงุฆู
```

### ุชุบููุฑ ุนุฏุฏ ุงููุญุงููุงุช:
```typescript
// ูู /api/verify-otp/route.ts
if (otpData.attempts >= 5) { // ุชุบููุฑ 5 ุฅูู ุงูุนุฏุฏ ุงููุทููุจ
```

### ุชุบููุฑ ูุคูุช ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู:
```typescript
// ูู /app/auth/verify-otp/page.tsx
setResendCooldown(60) // ุชุบููุฑ 60 ุซุงููุฉ
```

---

## ๐ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

### ุญุงูุงุช ุงูุฎุทุฃ ุงููุนุงูุฌุฉ:

```typescript
โ "ูุนูููุงุช ุบูุฑ ุตุญูุญุฉ" - ุจูุงูุงุช ูุงูุตุฉ
โ "ุฑูุฒ ุงูุชุญูู ุบูุฑ ููุฌูุฏ" - OTP ููุชูู ุฃู ูุญุฐูู
โ "ุชู ุงูุชุญูู ูุณุจูุงู" - OTP ูุณุชุฎุฏู
โ "ุชุฌุงูุฒ ุนุฏุฏ ุงููุญุงููุงุช" - ุฃูุซุฑ ูู 5 ูุญุงููุงุช
โ "ุงูุชูุช ุงูุตูุงุญูุฉ" - ูุฑูุฑ 10 ุฏูุงุฆู
โ "ุฑูุฒ ุบูุฑ ุตุญูุญ" - OTP ุฎุงุทุฆ
โ "ูุดู ุฅุฑุณุงู ุงูุฑูุฒ" - ูุดููุฉ ูู ุงูุจุฑูุฏ
```

---

## ๐ ุงูุชุชุจุน ูุงูุชุญููู

### Console Logs:

```typescript
1. "๐ Development OTP: XXXXXX" - ุงูุฑูุฒ ูู ูุถุน ุงูุชุทููุฑ
2. "๐ง OTP for email@example.com: XXXXXX" - ุงูุณุฌู
3. Verification errors - ุฃุฎุทุงุก ุงูุชุญูู
4. Resend errors - ุฃุฎุทุงุก ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู
```

### ุงูุจูุงูุงุช ุงูููุฎุฒููุฉ:

```
Firestore/otpCodes:
  - ุนุฏุฏ ุงูุฑููุฒ ุงููุดุทุฉ
  - ุนุฏุฏ ุงููุญุงููุงุช ููู ูุณุชุฎุฏู
  - ูุนุฏู ุงููุฌุงุญ

Firestore/users:
  - emailVerified: boolean
  - verifiedAt: timestamp
```

---

## ๐ Testing (ุงูุงุฎุชุจุงุฑ)

### ูุถุน ุงูุชุทููุฑ:
```typescript
1. ุณุฌูู ุญุณุงุจ ุฌุฏูุฏ
2. ุณูุธูุฑ ุงูุฑูุฒ ูู:
   - Console (F12)
   - Toast notification (ุฃุนูู ุงูุดุงุดุฉ)
3. ุงูุณุฎ ุงูุฑูุฒ
4. ุงูุตูู ูู ุงูุญููู
```

### ูุถุน ุงูุฅูุชุงุฌ:
```typescript
1. ุชุฃูุฏ ูู ุฅุนุฏุงุฏ ุฎุฏูุฉ ุงูุจุฑูุฏ
2. ุงุฎุชุจุฑ ุฅุฑุณุงู ุงูุจุฑูุฏ
3. ุชุญูู ูู inbox/spam
4. ุงุฎุชุจุฑ ุฌููุน ุงูุญุงูุงุช:
   - ุฅุฏุฎุงู ุตุญูุญ
   - ุฅุฏุฎุงู ุฎุงุทุฆ
   - ุงูุชูุงุก ุงูุตูุงุญูุฉ
   - ุชุฌุงูุฒ ุงููุญุงููุงุช
   - ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู
```

---

## ๐ฏ ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ

- [ ] ุฏุนู SMS ุจุฌุงูุจ ุงูุจุฑูุฏ
- [ ] ุฑููุฒ OTP ุฃุจุฌุฏูุฉ ุฑูููุฉ
- [ ] ุฑููุฒ ุงุญุชูุงุทูุฉ (Backup Codes)
- [ ] ุฅุญุตุงุฆูุงุช ุงูุชุญูู
- [ ] ุชุฎุตูุต ูุงูุจ ุงูุจุฑูุฏ ูู Dashboard
- [ ] Multi-language support
- [ Phone number verification
- [ ] Biometric verification

---

## ๐ ุงูููุงุญุธุงุช ุงููููุฉ

### โ๏ธ ูู ุงูุชุทููุฑ:
```
โ ุงูุฑูุฒ ูุธูุฑ ูู Console ูToast
โ ูุง ุญุงุฌุฉ ูุฅุนุฏุงุฏ ุงูุจุฑูุฏ ุงููุนูู
โ ุงูููุช ุงูุงูุชุฑุงุถู 10 ุฏูุงุฆู
```

### ๐ ูู ุงูุฅูุชุงุฌ:
```
! ูุฌุจ ุฅุนุฏุงุฏ ุฎุฏูุฉ ุจุฑูุฏ ุญููููุฉ
! ุฅุฒุงูุฉ console.log ููุฑููุฒ
! ุฅุฒุงูุฉ devOTP ูู ุงูุงุณุชุฌุงุจุฉ
! ุชูุนูู rate limiting
! ูุฑุงูุจุฉ ูุญุงููุงุช ุงููุฌูุงุช
```

---

## ๐ ุงูุฏุนู ุงูููู

### ูุดุงูู ุดุงุฆุนุฉ:

**1. ูุง ูุตู ุงูุจุฑูุฏุ**
```
- ุชุญูู ูู spam/junk
- ุชุฃูุฏ ูู ุฅุนุฏุงุฏุงุช SMTP
- ุฑุงุฌุน console ููุฃุฎุทุงุก
- ุชุญูู ูู API key
```

**2. ุงูุฑูุฒ ุบูุฑ ุตุญูุญ ุฏุงุฆูุงูุ**
```
- ุชุญูู ูู console.log
- ุฑุงุฌุน Firestore ููุฑูุฒ ุงููุญููุธ
- ุชุฃูุฏ ูู ุชูููุช ุงูุฎุงุฏู
```

**3. ูุง ููุฑุณู ุงูุฑูุฒุ**
```
- ุฑุงุฌุน /api/send-otp logs
- ุชุญูู ูู Firebase permissions
- ุฑุงุฌุน email service status
```

---

ุชู ุงูุชุทููุฑ ุจู โค๏ธ ุจูุงุณุทุฉ Ahmad AL-faqeih
**ุงูุฅุตุฏุงุฑ:** 2.0.0  
**ุงูุชุงุฑูุฎ:** ูุจุฑุงูุฑ 2026
